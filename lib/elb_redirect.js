// Generated by CoffeeScript 1.9.2
(function() {
  var ELBRedirect,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  ELBRedirect = (function() {
    ELBRedirect.deps = {
      services: ['logger', 'server']
    };

    function ELBRedirect(kit) {
      this.server_start = bind(this.server_start, this);
      var f;
      f = 'ELBRedirect:constructor';
      this.log = kit.services.logger.log;
    }

    ELBRedirect.prototype.server_start = function(kit) {
      var f, server;
      f = 'ELBRedirect:server_start:';
      server = kit.services.server.server;
      return server.use((function(_this) {
        return function(req, res, next) {
          var path;
          if (req.method === 'GET' && req.headers['x-forwarded-proto'] === 'http') {
            path = 'https://' + req.header('host') + req.href();
            _this.log.debug(f, {
              method: req.method,
              header: req.headers['x-forwarded-proto'],
              path: path
            });
            res.setHeader('location', path);
            return res.send(302);
          } else {
            return next();
          }
        };
      })(this));
    };

    return ELBRedirect;

  })();

  exports.ELBRedirect = ELBRedirect;

}).call(this);
